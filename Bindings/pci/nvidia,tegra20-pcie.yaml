# SPDX-License-Identifier: None
%YAML 1.2
---
$id: http://devicetree.org/schemas/Bindings/pci/nvidia,tegra20-pcie.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#
version: 1

title: NVIDIA Tegra PCIe controller

maintainers:
  - Thierry Reding <thierry.reding@avionic-design.de>
  - Thierry Reding <treding@nvidia.com>
description: test

properties:
  compatible:
    items:
      - const: nvidia,tegra20-pcie
    minItems: 1
    maxItems: 1
    additionalItems: false
  device_type:
    items:
      - const: pci
    minItems: 1
    maxItems: 1
    additionalItems: false
  reg:
    minItems: 1
    maxItems: 1
    additionalItems: false
  reg-names:
    items:
      - const: pads
      - const: afi
      - const: cs
    minItems: 3
    maxItems: 3
    additionalItems: false
  interrupts: {}
  interrupt-names:
    items:
      - const: intr
      - const: msi
    minItems: 2
    maxItems: 2
    additionalItems: false
  '#interrupt-cells':
    const: 0x1
  interrupt-map-mask: {}
  interrupt-map: {}
  bus-range: {}
  '#address-cells':
    const: 0x3
  '#size-cells':
    const: 0x2
  ranges: {}
  clocks: {}
  clock-names:
    items:
      - const: pex
      - const: afi
      - const: pll_e
    minItems: 3
    maxItems: 3
    additionalItems: false
  resets: {}
  reset-names:
    items:
      - const: pex
      - const: afi
      - const: pcie_x
    minItems: 3
    maxItems: 3
    additionalItems: false
  avdd-pex-supply: {}
  vdd-pex-supply: {}
  avdd-pex-pll-supply: {}
  avdd-plle-supply: {}
  vddio-pex-clk-supply: {}
historical: |+
  NVIDIA Tegra PCIe controller

  Required properties:
  - compatible: Must be:
    - "nvidia,tegra20-pcie": for Tegra20
    - "nvidia,tegra30-pcie": for Tegra30
    - "nvidia,tegra124-pcie": for Tegra124 and Tegra132
    - "nvidia,tegra210-pcie": for Tegra210
    - "nvidia,tegra186-pcie": for Tegra186
  - power-domains: To ungate power partition by BPMP powergate driver. Must
    contain BPMP phandle and PCIe power partition ID. This is required only
    for Tegra186.
  - device_type: Must be "pci"
  - reg: A list of physical base address and length for each set of controller
    registers. Must contain an entry for each entry in the reg-names property.
  - reg-names: Must include the following entries:
    "pads": PADS registers
    "afi": AFI registers
    "cs": configuration space region
  - interrupts: A list of interrupt outputs of the controller. Must contain an
    entry for each entry in the interrupt-names property.
  - interrupt-names: Must include the following entries:
    "intr": The Tegra interrupt that is asserted for controller interrupts
    "msi": The Tegra interrupt that is asserted when an MSI is received
  - bus-range: Range of bus numbers associated with this controller
  - #address-cells: Address representation for root ports (must be 3)
    - cell 0 specifies the bus and device numbers of the root port:
      [23:16]: bus number
      [15:11]: device number
    - cell 1 denotes the upper 32 address bits and should be 0
    - cell 2 contains the lower 32 address bits and is used to translate to the
      CPU address space
  - #size-cells: Size representation for root ports (must be 2)
  - ranges: Describes the translation of addresses for root ports and standard
    PCI regions. The entries must be 6 cells each, where the first three cells
    correspond to the address as described for the #address-cells property
    above, the fourth cell is the physical CPU address to translate to and the
    fifth and six cells are as described for the #size-cells property above.
    - The first two entries are expected to translate the addresses for the root
      port registers, which are referenced by the assigned-addresses property of
      the root port nodes (see below).
    - The remaining entries setup the mapping for the standard I/O, memory and
      prefetchable PCI regions. The first cell determines the type of region
      that is setup:
      - 0x81000000: I/O memory region
      - 0x82000000: non-prefetchable memory region
      - 0xc2000000: prefetchable memory region
    Please refer to the standard PCI bus binding document for a more detailed
    explanation.
  - #interrupt-cells: Size representation for interrupts (must be 1)
  - interrupt-map-mask and interrupt-map: Standard PCI IRQ mapping properties
    Please refer to the standard PCI bus binding document for a more detailed
    explanation.
  - clocks: Must contain an entry for each entry in clock-names.
    See ../clocks/clock-bindings.txt for details.
  - clock-names: Must include the following entries:
    - pex
    - afi
    - pll_e
    - cml (not required for Tegra20)
  - resets: Must contain an entry for each entry in reset-names.
    See ../reset/reset.txt for details.
  - reset-names: Must include the following entries:
    - pex
    - afi
    - pcie_x

  Required properties on Tegra124 and later (deprecated):
  - phys: Must contain an entry for each entry in phy-names.
  - phy-names: Must include the following entries:
    - pcie

  These properties are deprecated in favour of per-lane PHYs define in each of
  the root ports (see below).

  Power supplies for Tegra20:
  - avdd-pex-supply: Power supply for analog PCIe logic. Must supply 1.05 V.
  - vdd-pex-supply: Power supply for digital PCIe I/O. Must supply 1.05 V.
  - avdd-pex-pll-supply: Power supply for dedicated (internal) PCIe PLL. Must
    supply 1.05 V.
  - avdd-plle-supply: Power supply for PLLE, which is shared with SATA. Must
    supply 1.05 V.
  - vddio-pex-clk-supply: Power supply for PCIe clock. Must supply 3.3 V.

  Power supplies for Tegra30:
  - Required:
    - avdd-pex-pll-supply: Power supply for dedicated (internal) PCIe PLL. Must
      supply 1.05 V.
    - avdd-plle-supply: Power supply for PLLE, which is shared with SATA. Must
      supply 1.05 V.
    - vddio-pex-ctl-supply: Power supply for PCIe control I/O partition. Must
      supply 1.8 V.
    - hvdd-pex-supply: High-voltage supply for PCIe I/O and PCIe output clocks.
      Must supply 3.3 V.
  - Optional:
    - If lanes 0 to 3 are used:
      - avdd-pexa-supply: Power supply for analog PCIe logic. Must supply 1.05 V.
      - vdd-pexa-supply: Power supply for digital PCIe I/O. Must supply 1.05 V.
    - If lanes 4 or 5 are used:
      - avdd-pexb-supply: Power supply for analog PCIe logic. Must supply 1.05 V.
      - vdd-pexb-supply: Power supply for digital PCIe I/O. Must supply 1.05 V.

  Power supplies for Tegra124:
  - Required:
    - avddio-pex-supply: Power supply for analog PCIe logic. Must supply 1.05 V.
    - dvddio-pex-supply: Power supply for digital PCIe I/O. Must supply 1.05 V.
    - avdd-pex-pll-supply: Power supply for dedicated (internal) PCIe PLL. Must
      supply 1.05 V.
    - hvdd-pex-supply: High-voltage supply for PCIe I/O and PCIe output clocks.
      Must supply 3.3 V.
    - hvdd-pex-pll-e-supply: High-voltage supply for PLLE (shared with USB3).
      Must supply 3.3 V.
    - vddio-pex-ctl-supply: Power supply for PCIe control I/O partition. Must
      supply 2.8-3.3 V.
    - avdd-pll-erefe-supply: Power supply for PLLE (shared with USB3). Must
      supply 1.05 V.

  Power supplies for Tegra210:
  - Required:
    - avdd-pll-uerefe-supply: Power supply for PLLE (shared with USB3). Must
      supply 1.05 V.
    - hvddio-pex-supply: High-voltage supply for PCIe I/O and PCIe output
      clocks. Must supply 1.8 V.
    - dvddio-pex-supply: Power supply for digital PCIe I/O. Must supply 1.05 V.
    - dvdd-pex-pll-supply: Power supply for dedicated (internal) PCIe PLL. Must
      supply 1.05 V.
    - hvdd-pex-pll-e-supply: High-voltage supply for PLLE (shared with USB3).
      Must supply 3.3 V.
    - vddio-pex-ctl-supply: Power supply for PCIe control I/O partition. Must
      supply 1.8 V.

  Power supplies for Tegra186:
  - Required:
    - dvdd-pex-supply: Power supply for digital PCIe I/O. Must supply 1.05 V.
    - hvdd-pex-pll-supply: High-voltage supply for PLLE (shared with USB3). Must
      supply 1.8 V.
    - hvdd-pex-supply: High-voltage supply for PCIe I/O and PCIe output clocks.
      Must supply 1.8 V.
    - vddio-pexctl-aud-supply: Power supply for PCIe side band signals. Must
      supply 1.8 V.

  Root ports are defined as subnodes of the PCIe controller node.

  Required properties:
  - device_type: Must be "pci"
  - assigned-addresses: Address and size of the port configuration registers
  - reg: PCI bus address of the root port
  - #address-cells: Must be 3
  - #size-cells: Must be 2
  - ranges: Sub-ranges distributed from the PCIe controller node. An empty
    property is sufficient.
  - nvidia,num-lanes: Number of lanes to use for this port. Valid combinations
    are:
    - Root port 0 uses 4 lanes, root port 1 is unused.
    - Both root ports use 2 lanes.

  Required properties for Tegra124 and later:
  - phys: Must contain an phandle to a PHY for each entry in phy-names.
  - phy-names: Must include an entry for each active lane. Note that the number
    of entries does not have to (though usually will) be equal to the specified
    number of lanes in the nvidia,num-lanes property. Entries are of the form
    "pcie-N": where N ranges from 0 to the value specified in nvidia,num-lanes.

...
